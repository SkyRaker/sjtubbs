/**
 * 
 */
package com.tyt.bbs;

import org.jsoup.Jsoup;
import org.jsoup.nodes.Element;
import org.jsoup.select.Elements;

import android.app.Activity;
import android.app.Dialog;
import android.os.AsyncTask;
import android.os.Bundle;
import android.util.Log;
import android.view.LayoutInflater;
import android.view.View;
import android.view.View.OnClickListener;
import android.widget.AdapterView;
import android.widget.AdapterView.OnItemClickListener;
import android.widget.ListView;
import android.widget.Toast;

import com.tyt.bbs.adapter.DiffAdapter;
import com.tyt.bbs.adapter.MsgListAdapter;
import com.tyt.bbs.entity.MessageItem;
import com.tyt.bbs.utils.Net;
import com.tyt.bbs.utils.Property;
import com.tyt.bbs.view.TitleFlowIndicator;
import com.tyt.bbs.view.ViewFlow;
import com.tyt.bbs.view.ViewFlow.ViewSwitchListener;

/**
 * @author tyt2011
 *com.tyt.bbs
 */
public class MessageActivity extends Activity implements OnClickListener {

	private static final int DIALOG_REPLAY = 0;
	private ViewFlow viewFlow;
	DiffAdapter adapter;

	/* (non-Javadoc)
	 * @see android.app.Activity#onCreate(android.os.Bundle)
	 */
	@Override
	protected void onCreate(Bundle savedInstanceState) {
		// TODO Auto-generated method stub
		super.onCreate(savedInstanceState);
		setContentView(R.layout.a_msg);
		findViewById(R.id.btn_msgrefresh).setOnClickListener(this);
		viewFlow = (ViewFlow) findViewById(R.id.viewflow);
		adapter = new DiffAdapter(this,listener);
		viewFlow.setAdapter(adapter, 0);
		TitleFlowIndicator indicator = (TitleFlowIndicator) findViewById(R.id.viewflowindic);
		indicator.setTitleProvider(adapter);
		viewFlow.setFlowIndicator(indicator);
		viewFlow.setOnViewSwitchListener(new ViewSwitchListener(){

			@Override
			public void onSwitched(View view, int position) {
				// TODO Auto-generated method stub
				adapter.setSelectPosition(position);
				adapter.notifyDataSetChanged();
			}
			
		});
	}
		
	private final OnItemClickListener listener  =new OnItemClickListener(){

		@Override
		public void onItemClick(AdapterView<?> parent, View view, int position,
				long id) {
			// TODO Auto-generated method stub
			MsgListAdapter madapter = (MsgListAdapter)parent.getAdapter();
			try {
				Net.getInstance().getMsgMarkread(Property.Base_URL+"/"+madapter.getItem(position).getLink());
			} catch (Exception e) {
				// TODO Auto-generated catch block
				e.printStackTrace();
			}
			Toast.makeText(MessageActivity.this, "  "+Net.getInstance().GMTString(), 500).show();
		}
		
	};

	/* (non-Javadoc)
	 * @see android.app.Activity#onCreateDialog(int)
	 */
	@Override
	protected Dialog onCreateDialog(int id) {
		// TODO Auto-generated method stub
		switch(id){
		case DIALOG_REPLAY:
			final Dialog mReplayDialog = new Dialog(this, R.style.Dialog);
			View dv = LayoutInflater.from(this).inflate(R.layout.dialog_reply_msg, null);
			dv.findViewById(R.id.msg_reply).setOnClickListener(this);
			dv.setOnClickListener(this);
			mReplayDialog.setContentView(dv);
			return mReplayDialog;
		}
		return null;
	}

	/* (non-Javadoc)
	 * @see android.view.View.OnClickListener#onClick(android.view.View)
	 */
	@Override
	public void onClick(View v) {
		// TODO Auto-generated method stub
		switch(v.getId()){
		case R.id.body:
			dismissDialog(DIALOG_REPLAY);			
			break;
		case R.id.msg_reply:
			
			break;
		case R.id.btn_msgrefresh:
			adapter.setSelectPosition(0);
			adapter.notifyDataSetChanged();
			break;
		}
	}
	
	

}
